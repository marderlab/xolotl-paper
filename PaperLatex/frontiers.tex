%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% This is just an example/guide for you to refer to when submitting manuscripts to Frontiers, it is not mandatory to use Frontiers .cls files nor frontiers.tex  %
% This will only generate the Manuscript, the final article will be typeset by Frontiers after acceptance.   
%                                              %
%                                                                                                                                                         %
% When submitting your files, remember to upload this *tex file, the pdf generated with it, the *bib file (if bibliography is not within the *tex) and all the figures.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%% Version 3.3 Generated 2018/01/26 %%%
%%% You will need to have the following packages installed: datetime, fmtcount, etoolbox, fcprefix, which are normally inlcuded in WinEdt. %%%
%%% In http://www.ctan.org/ you can find the packages and how to install them, if necessary. %%%
%%%  NB logo1.jpg is required in the path in order to correctly compile front page header %%%

\documentclass[utf8]{frontiersSCNS} % for Science, Engineering and Humanities and Social Sciences articles
%\documentclass[utf8]{frontiersHLTH} % for Health articles
%\documentclass[utf8]{frontiersFPHY} % for Physics and Applied Mathematics and Statistics articles

%\setcitestyle{square} % for Physics and Applied Mathematics and Statistics articles
\usepackage{url,hyperref,lineno,microtype,subcaption}
\usepackage[onehalfspacing]{setspace}
\usepackage{natbib}
\usepackage{placeins}

\linenumbers


% Leave a blank line between paragraphs instead of using \\


\def\keyFont{\fontsize{8}{11}\helveticabold }
\def\firstAuthorLast{Hoyland, Gorur-Shandilya, \& Marder} %use et al only if is more than 1 author
\def\Authors{Alec Hoyland, Srinivas Gorur-Shandilya\,$^{*}$, and Eve Marder}
% Affiliations should be keyed to the author's name with superscript numbers and be listed as follows: Laboratory, Institute, Department, Organization, City, State abbreviation (USA, Canada, Australia), and Country (without detailed address information such as city zip codes or street names).
% If one of the authors has a change of address, list the new address below the correspondence details using a superscript symbol and use the same symbol to indicate the author in the author list.
\def\Address{Marder Lab, Brandeis University, Biology Department and Volen Center for Complex Systems, Waltham, MA, USA}
% The Corresponding Author should be marked with an asterisk
% Provide the exact contact address (this time including street name and city zip code) and email of the corresponding author
\def\corrAuthor{Srinivas Gorur-Shandilya
%
%Volen Center for Complex Systems
%
%Brandeis University
%
%415 South Street
%
%Waltham, MA 02454
%
%USA
}

\def\corrEmail{srinivasgs@brandeis.edu}




\begin{document}
\onecolumn
\firstpage{1}

\title[xolotl: neuronal simulator]{Xolotl: An Intuitive and Comprehensible Neuronal Simulator} 

\author[\firstAuthorLast]{\Authors} %This field will be automatically populated
\address{} %This field will be automatically populated
\correspondance{} %This field will be automatically populated

\extraAuth{}% If there are more than 1 corresponding author, comment this line and uncomment the next one.
%\extraAuth{corresponding Author2 \\ Laboratory X2, Institute X2, Department X2, Organization X2, Street X2, City X2 , State XX2 (only USA, Canada and Australia), Zip Code2, X2 Country X2, email2@uni2.edu}


\maketitle


\begin{abstract}

%%% Leave the Abstract empty if your article does not require one, please see the Summary Table for full details.
\texttt{xolotl} is an open-source neuronal simulator written in \texttt{C++} with \texttt{MATLAB} wrappers. Complex models and networks can be designed efficiently using an intuitive language tightly coupled to the object-based architecture of the underlying \texttt{C++} code. Models are specified by adding conductances to compartment objects. The structure is modular, serialized, and searchable, permitting high-level programmatic control over nearly all features of the models. \texttt{C++} templates are provided for developing new conductances, compartments, and integration schemata. \texttt{xolotl} readily implements parallel-processing on multicore processors and high-performance computing clusters. It also includes a customizable graphical user interface (`puppeteer`) for rapid prototyping and hand-tuning conductances in real-time. In addition, \texttt{xolotl} comes packaged with a powerful optimization toolbox (\texttt{procrustes}) for optimizing any model parameters accessible in the \texttt{xolotl} tree. The modular structure and accessibility to all parameters, variables, and dynamics of the model network in \texttt{MATLAB} facilitate rapid construction and assessment of model networks. \texttt{xolotl} is freely available at \url{https://github.com/sg-s/xolotl}. This tool provides straightforward implementation and fast simulation of neuronal models while permitting full control over every aspect of the network and integration.  


\tiny
 \keyFont{ \section{Keywords:} simulator, MATLAB, C++, xolotl, conductance-based, computational, keyword, keyword} %All article types: you may provide up to 8 keywords; at least 5 are mandatory.
\end{abstract}

\section{Introduction}

\texttt{xolotl} (\url{https://github.com/sg-s/xolotl}) is a fast single-compartment and multi-compartment simulator in \texttt{C++} with \texttt{MATLAB} wrappers (\url{https://www.mathworks.com/products/matlab.html}). Written with an emphasis on flexibility and speed, \texttt{xolotl} can simulate single-compartment conductance-based models, networks of these, and detailed multi-compartment models. \texttt{xolotl} exploits a novel automatic type system, \texttt{cpplab}, which binds \texttt{MATLAB} code to \texttt{C++} header files, creating objects and classes \textit{ad libitum} in \texttt{MATLAB} which reflect the underlying object-oriented code. \texttt{xolotl} implements \texttt{cpplab} to represent the nested structure of conductance-based models, and exploits the computational efficiency of the low-level programming language to quickly integrate models. For this reason, models can be implemented entirely in \texttt{MATLAB} with few lines of code.

Models are specified in \texttt{MATLAB} by a \texttt{xolotl} object which contains compartment objects which themselves contain conductances. Synapses belong to the \texttt{xolotl} object and connect compartments together. The high-level specification supports arbitrarily large network and multi-compartment morphologies. 

\texttt{xolotl} provides parameter optimization capabilities through the algorithm-agnostic \texttt{procrustes} toolbox. Any network parameters accessible through the \texttt{xolotl} structure can be optimized using arbitrary algorithms and objective functions on multi-core computers and high-performance computing clusters.

The software has been implemented in \texttt{MATLAB} due to its ease-of-use and popularity among neuroscientists. \texttt{cpplab} provides a powerful backend for specifying and integrating models without relying on the significantly slower and limiting \texttt{MATLAB codegen}. Minimal experience with \texttt{MATLAB} is required to use \texttt{xolotl}, and all equations and integration methods are provided transparently to the end user. No string parsing of equations is required. 

\texttt{xolotl} comes packaged with visualization functions, a graphical user interface for real-time manipulation of model parameters. Plotting of voltage, intracellular calcium, conductance gating functions, and time constants is provided by built-in \texttt{xolotl} methods. The \texttt{puppeteer} toolbox permits real-time tuning of any network parameters using numerical sliders in a graphical interface which displays the resultant membrane potential and intracellular calcium traces. The ease-of-use of these tools lends them to pedagogical applications and rapid exploration of toy models. This tool aims to simplify the investigation of dynamics of complex neural network models, facilitate collaborative modeling, and complement other tools being developed in the neuroinformatics community.

\section{Article types}

For requirements for a specific article type please refer to the Article Types on any Frontiers journal page. Please also refer to  \href{http://home.frontiersin.org/about/author-guidelines#Sections}{Author Guidelines} for further information on how to organize your manuscript in the required sections or their equivalents for your field

% For Original Research articles, please note that the Material and Methods section can be placed in any of the following ways: before Results, before Discussion or after Discussion.

\section{Worked Examples}

Using \texttt{xolotl} in \texttt{MATLAB}, users create a \texttt{xolotl} object and populate it with compartments, synapses, and controllers. Each field is a \texttt{cpplab} object constructed by a function call to \texttt{add}. The model is integrated with the \texttt{integrate} function where the membrane potential, intracellular calcium concentration, controller states, intrinsic currents, and synaptic currents can be outputs.

\texttt{xolotl} comes packaged with a library of pre-existing conductance and synapse objects which greatly simplify the task of constructing model neurons. These objects can be referenced by name and added directly to a compartment. Novel conductance dynamics can be easily written by modifying a template header file contained in the \texttt{xolotl} distribution. 

\subsection{Simulating a Hodgkin-Huxley Model}

The seminal Hodgkin-Huxley model contains a fast inactivating sodium conductance which promotes spiking, a non-inactivating potassium delayed rectifer, and a passive leak current (\ref{fig:figurehh}A). A compartment named \texttt{HH} with compartment properties of membrane capacitance $C_m = 10 ~ \mu\mathrm{F/mm^2}$ and surface area $A = 0.1 ~ \mathrm{mm^2}$ can be specified by \ref{fig:figurehh}B. Compartment, conductance, synapse, and controller properties can be specified during the call to the \texttt{add} function, or after construction, using dot-notation in \texttt{MATLAB} (e.g. \texttt{x.HH.Cm}). \ref{fig:figurehh}C shows the \texttt{MATLAB} command prompt after invoking the \texttt{xolotl} object \texttt{x}, displaying the hierarchical structure inherent in conductance-based treatments of neurodynamics.

This model was constructed using conductances from Liu \textit{et al} 1998. In the absence of applied positive current, the model is quiescent and tonically spikes under 0.2 nA of applied current (\ref{fig:figurehh}D). The \texttt{integrate} function takes the applied current as an argument (e.g. \texttt{x.integrate(AppliedCurrent)}), so that the \texttt{xolotl} object is agnostic to integration-specific perturbations. The \texttt{plot} function generates voltage and intracellular calcium traces, where the voltage trace is colored by the dominant current. If the membrane potential is increasing, the strongest instantaneous inward current colors the trace. Conversely, if the membrane potential is decreasing, the strongest outward current colors the trace instead. \ref{fig:figurehh}F-I display the results of the \texttt{show} function. Activation and inactivation steady-states and the voltage-dependent time constants of these gating variables describe the conductance dynamics in absence of other channel types.

\subsection{Performing a Voltage Clamp Experiment \textit{in-silico}}

\texttt{xolotl} can recapitulate the results of voltage clamp experiments. \ref{fig:figureclamp} displays the procedure to clamp the membrane potential of a cell with a delayed rectifier potassium conductance. The second argument of the \texttt{integrate} function determines the clamped voltage (e.g. \texttt{x.integrate([], VoltageClamp)}). Isolated currents under voltage clamp approach the steady-state (\ref{fig:figureclamp}D-E) so that a current-voltage relation at steady-state can be extracted (\ref{fig:figureclamp}F). The derivative of the IV curve is the steady-state conductance (\ref{fig:figureclamp}G). Fitting a sigmoid to various powers yields a model for the current dynamics (\ref{fig:figureclamp}H-I). These figures describe graphically the theoretical underpinnings of current analysis through voltage clamp and can serve as an effective pedagogical tool for computational and quantitative neuroscience.

\subsection{Simulating Network Models}

Network models in \texttt{xolotl} consist of compartment objects connected by synapses. Synapses are stored in a vector array as a field of the \texttt{xolotl} object in \texttt{MATLAB}. Presynaptic and postsynaptic labels indicate the connectivity of the synapse. Figure \ref{fig:figurenetwork} implements a model of the triphasic pyloric rhythm in the stomatogastric ganglion of crustaceans. The pyloric model contains three compartments and seven synapses (\ref{fig:figurenetwork}A). This structure is reciprocated in the hierarchy of the \texttt{xolotl} object, where conductances are contained within compartments (\ref{fig:figurenetwork}B). Synapses are upper-level properties of the network which point between two compartments (\ref{fig:figurenetwork}C). This exploits vectorized operations in \texttt{MATLAB} and does not require each synapse to possess a unique name. The \texttt{plot} function generates multiple subplots when called for a network with multiple compartments (\ref{fig:figurenetwork}D-F).

\section{Manuscript Formatting}

\subsection{Heading Levels}

%There are 5 heading levels

\subsection{Level 2}
\subsubsection{Level 3}
\paragraph{Level 4}
\subparagraph{Level 5}

\subsection{Equations}
Equations should be inserted in editable format from the equation editor.

\begin{equation}
\sum x+ y =Z\label{eq:01}
\end{equation}

\subsection{Figures}
Frontiers requires figures to be submitted individually, in the same order as they are referred to in the manuscript. Figures will then be automatically embedded at the bottom of the submitted manuscript. Kindly ensure that each table and figure is mentioned in the text and in numerical order. Figures must be of sufficient resolution for publication \href{http://home.frontiersin.org/about/author-guidelines#ResolutionRequirements}{see here for examples and minimum requirements}. Figures which are not according to the guidelines will cause substantial delay during the production process. Please see \href{http://home.frontiersin.org/about/author-guidelines#GeneralStyleGuidelinesforFigures}{here} for full figure guidelines. Cite figures with subfigures as figure \ref{fig:2}B.

\subsubsection{Permission to reuse and Copyright}
Permission must be obtained for use of copyrighted material from other sources (including the web). Please note that it is compulsory to follow figure instructions. 

\subsection{Tables}
Tables should be inserted at the end of the manuscript. Please build your table directly in LaTeX.Tables provided as jpeg/tiff files will not be accepted. Please note that very large tables (covering several pages) cannot be included in the final PDF for reasons of space. These tables will be published as \href{http://home.frontiersin.org/about/author-guidelines#SupplementaryMaterial}{Supplementary Material} on the online article page at the time of acceptance. The author will be notified during the typesetting of the final article if this is the case. 

\section*{Conflict of Interest Statement}
%All financial, commercial or other relationships that might be perceived by the academic community as representing a potential conflict of interest must be disclosed. If no such relationship exists, authors will be asked to confirm the following statement: 

The authors declare that the research was conducted in the absence of any commercial or financial relationships that could be construed as a potential conflict of interest.

\section*{Author Contributions}

AH and SG-S wrote the manuscript and the code. EM provided funding and moral support.

\section*{Funding}
Details of all funding sources should be provided, including grant numbers if applicable. Please ensure to add all necessary funding information, as after publication this is no longer possible.

AH received funding from National Institute on Drug Abuse (NIDA) through the undergraduate training grant in computational neuroscience (1R90DA033463-01).

\section*{Acknowledgments}
The authors would like to thank Mara CP Rue and Hillary Rodgers for beta-testing the \texttt{xolotl} software.

\section*{Supplemental Data}
 \href{http://home.frontiersin.org/about/author-guidelines#SupplementaryMaterial}{Supplementary Material} should be uploaded separately on submission, if there are Supplementary Figures, please include the caption in the same file as the figure. LaTeX Supplementary Material templates can be found in the Frontiers LaTeX folder.

\section*{Data Availability Statement}

The code to generate all figures can be found in the \texttt{xolotl} repository (\url{https://github.com/sg-s/xolotl}).

\bibliographystyle{frontiersinSCNS_ENG_HUMS} % for Science, Engineering and Humanities and Social Sciences articles, for Humanities and Social Sciences articles please include page numbers in the in-text citations
%\bibliographystyle{frontiersinHLTH&FPHY} % for Health, Physics and Mathematics articles
\bibliography{test}

%%% Make sure to upload the bib file along with the tex file and PDF
%%% Please see the test.bib file for some examples of references

\section*{Figure captions}

%%% Please be aware that for original research articles we only permit a combined number of 15 figures and tables, one figure with multiple subfigures will count as only one figure.
%%% Use this if adding the figures directly in the mansucript, if so, please remember to also upload the files when submitting your article
%%% There is no need for adding the file termination, as long as you indicate where the file is saved. In the examples below the files (logo1.eps and logos.eps) are in the Frontiers LaTeX folder
%%% If using *.tif files convert them to .jpg or .png
%%%  NB logo1.eps is required in the path in order to correctly compile front page header %%%

\begin{figure}
	\centering
	\includegraphics[width=1.0\linewidth]{gfx/figure_HH}
	\caption{\texttt{xolotl} can quickly set up and simulate conductance-based models. (A) Cartoon of a Hodgkin-Huxley single-compartment neuron model with fast sodium, delayed rectifier, and leak currents. (B) Code snippet in \texttt{MATLAB} used to implement D, F-I. (C) \texttt{xolotl} schematic displayed in the \texttt{MATLAB} command prompt. (D) Simulated voltage trace with 0.1 nA applied current. Colors indicate the dominant current (gold is fast sodium, blue is delayed rectifier, red is leak). (E) Frequency-input relation displaying firing rate as a function of applied current. (F-G) Steady-state gating functions for activation (m) and inactivation (h) gating variables. Variables not plotted are unity for all voltage. (H-I) Voltage-dependence of time constants for activation (m) and inactivation (h) gating variables. Variables not plotted are unity for all voltage. Colors indicate conductance type (gold is fast sodium, blue is delayed rectifier, red is leak).}
	\label{fig:figurehh}
\end{figure}

\begin{figure}
	\centering
	\includegraphics[width=1.0\linewidth]{gfx/figure_clamp}
	\caption{\texttt{xolotl} readily implements voltage clamp. (A) Cartoon of a cell with potassium conductance with experimentally-fixed voltage. (B) Structure of \texttt{xolotl} object in A. (C) Code snippet depicting integration under voltage clamp. (D-E) Current response to steps in voltage from a holding potential of $V_m = -60$ mV. (F) Current-voltage relation of the steady-state current ($t = 400$ ms) indicating a reversal potential of $E = -80$ mV and no inactivation. (G) Conductance-voltage relation at steady-state takes the form of a sigmoid. (H) Sigmoids $m$ fit to the model as $m^n$ data indicating that $n=4$ is the best fit. (I) $R^2$ correlation of the sigmoid fits at various powers where $n=4$ is an exact fit.}
	\label{fig:figureclamp}
\end{figure}

\begin{figure}
	\centering
	\includegraphics[width=1.0\linewidth]{gfx/figure_network}
	\caption{\texttt{xolotl} readily implements conductance-based network models. (A) Diagram of a network model of the pyloric rhythm in the crustacean stomatogastric ganglion (Prinz \textit{et al.} 2004). (B) Hierarchical structure of a neuronal network considers compartments as components of the network and conductances and synapses as components of compartments. (C) \textit{xolotl} implements conductances as fields of compartments and synapses as connections between compartments. (D-F) Simulated voltage trace of a model network for the three compartments. (G) Time series of synaptic currents in the simulated network with model cholinergic (chol) and glutamatergic (glut) synapses are outputs of the integration.}
	\label{fig:figurenetwork}
\end{figure}

\begin{figure}
	\centering
	\includegraphics[width=1.0\linewidth]{gfx/figure_integral_control}
	\caption{\texttt{xolotl} can implement homeostatic tuning rules as integral control. (A) Cartoon of a model neuron with integral control. (B) Hierarchical structure of a neuronal network considers controllers as components of compartments which act on conductances. (C) \texttt{xolotl} implements controllers XYZ. (D) Calcium sensors change maximal conductances to move a neuron from quiescence to a bursting state. (E) Voltage trace of the controlled neuron shows regular bursting activity.}
	\label{fig:figureintegralcontrol}
\end{figure}

\end{document}
